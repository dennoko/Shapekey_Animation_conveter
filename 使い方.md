# 使い方（Shapekey Animation Converter）

このツールは、Unity上でシェイプキー（ブレンドシェイプ）を効率的に調整し、アニメーションファイルを作成するためのエディタ拡張です。UIは上から下に順番に設定していくことで、直感的にアニメーション作成ができます。
普段アニメーションファイルを直接編集して表情改変を行っている方のワークフローを劇的に改善することを目的としています。

---

## 1. メッシュの指定
- 最上部で「メッシュ」欄に顔のメッシュを指定します。※SkinnedMeshRendererを持つオブジェクトを指定してください。
- 対象メッシュが未選択の場合は警告が表示されます。

## 2. 既存アニメーションへのキー揃え

「保存するキーを既存のアニメーションに揃える」をONにすると、下の「ベースアニメーション」欄が有効になります。
ベースアニメーション（.animファイル）を指定し「適用」ボタンを押すと、そのアニメーションに含まれるブレンドシェイプのみが保存対象（チェック）になります。
vrc.* 系のシェイプキーは自動的に除外されます。

### この機能の主な目的
- **不要なシェイプキーの除外**
  - 表情アニメーションで制御すべきでないシェイプキー（例：エクスプレッションメニュー用やギミック用）を、既存アニメーションの構成に合わせて自動的に除外できます。
- **同じキー構成で差分アニメーションを作成**
  - 既存の表情アニメーションと同じシェイプキー構成で新しいアニメーションを作りたい場合に便利です。

### 使い方の例
- アバターの顔のシェイプキーに、表情以外の用途（エクスプレッションメニュー等）で使うものが混在している場合、
  デフォルトの表情アニメーションをベースアニメーションとして指定し「適用」することで、
  本当に必要なシェイプキーだけを保存対象にできます。
  これにより、不要なシェイプキーが表情アニメーションに含まれるのを防げます。
- 追加したいシェイプキーがある場合は、手動で保存対象にチェックを入れることも可能です。
- 一度作成したアニメーションをベースアニメーションとして指定し続けることで、
  以降も同じシェイプキー構成でアニメーション編集ができます。

## 3. アニメーションの適用
- 「アニメーションを適用」欄で、既存のアニメーション（.animファイル）を指定し「適用」ボタンを押すと、
 そのアニメーションの0秒時点のブレンドシェイプ値が現在のメッシュに反映されます。
- これにより、既存アニメーションの表情をプレビューしたり、編集のベースにできます。

## 4. 保存対象のフィルタ
- 「有効なシェイプのみ表示」をONにすると、保存対象（チェック済み）のシェイプキーだけが一覧に表示されます。表情差分の編集時などに便利です。

## 5. スナップショット機能
- 「一時保存（スナップショット）」ボタンで現在のシェイプキー値を保存できます。
- 「スナップショットにリセット」ボタンで保存した値に戻せます。
- デフォルトのシェイプキー値を保存しておくことで、いつでも瞬時に元の状態に戻せます。

## 6. シェイプキー検索
- 「シェイプキー検索」欄で名前検索ができます。複数語AND検索も可能です。
- AND検索の場合、単語ごとにスペースで区切って入力してください。ex: "eye down" → "eye"と"down"を両方含むシェイプキーを検索

## 7. シェイプキーの調整
- 一覧のスライダーで各シェイプキー値を調整します。
- チェックボックスで保存対象を選択できます。
- グループ単位で一括ON/OFFも可能です。

## 8. アニメーションの保存
- 一番下の「アニメーションを保存」ボタンで、現在の設定を.animファイルとして保存します。
- 保存先は「保存先（既定）」欄で指定できます。

## 9. 英語モード
- 画面右上の「英語モード」チェックでUIを英語に切り替えられます。

---

### よくある質問

#### Q. 「既存のアニメーションへのキー揃え」とは？
A. 既存のアニメーション（.anim）に含まれるブレンドシェイプだけを新しいアニメーションに出力する機能です。例えば、元の表情アニメーションと同じ構成で差分を作りたい場合や、不要なシェイプキーを除外したい場合に使います。アバターギミックとの干渉を避けることが目的です。

#### Q. ベースアニメーションの「適用」ボタンを押すとどうなる？
A. 指定したアニメーションに含まれるブレンドシェイプだけが保存対象（チェック）になります。vrc.* 系は除外されます。

#### Q. Undo/Redoは使えますか？
A. シェイプキー値の調整や保存対象の切り替えはUndo/Redoに対応しています。
